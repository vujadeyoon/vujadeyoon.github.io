<!DOCTYPE html>
<html lang="en">

  <!-- Head -->
  <head>        
    <!-- Metadata, OpenGraph and Schema.org -->
    

    <!-- Standard metadata -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Sungjun  Yoon | Docker with NVIDIA Container Toolkit for Deep Learning</title>
    <meta name="author" content="Sungjun  Yoon" />
    <meta name="description" content="The Dockerfile and docker commands for the deep learning that can be used in practice" />
    <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website" />


    <!-- Bootstrap & MDB -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous" />

    <!-- Fonts & Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons">

    <!-- Code Syntax Highlighting -->
    <link rel="stylesheet" href="https://gitcdn.link/repo/jwarby/jekyll-pygments-themes/master/github.css" />

    <!-- Styles -->
    
    <link rel="shortcut icon" href="/assets/ico/github.ico"/>
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="canonical" href="https://vujadeyoon.github.io/blog/2022/docker_with_NVIDIA_container_toolkit_for_deep_learning/">

    <!-- Dark Mode -->
    <script src="/assets/js/theme.js"></script>
    <script src="/assets/js/dark_mode.js"></script>
  </head>

  <!-- Body -->
  <body class="fixed-top-nav">

    <!-- Header -->
    <header>

      <!-- Nav Bar -->
      <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top">
        <div class="container">
          <a class="navbar-brand title font-weight-lighter" href="https://vujadeyoon.github.io/"><span class="font-weight-bold">Sungjun</span>   Yoon</a>
          <!-- Navbar Toggle -->
          <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar top-bar"></span>
            <span class="icon-bar middle-bar"></span>
            <span class="icon-bar bottom-bar"></span>
          </button>

          <div class="collapse navbar-collapse text-right" id="navbarNav">
            <ul class="navbar-nav ml-auto flex-nowrap">

              <!-- About -->
              <li class="nav-item ">
                <a class="nav-link" href="/">Main</a>
              </li>
              
              <!-- Blog -->
              <li class="nav-item active">
                <a class="nav-link" href="/blog/">Blog</a>
              </li>

              <!-- Other pages -->
              <li class="nav-item ">
                <a class="nav-link" href="/curriculum_vitae/">Curriculum Vitae</a>
              </li>
              <li class="nav-item ">
                <a class="nav-link" href="/projects/">Projects</a>
              </li>
              <li class="nav-item ">
                <a class="nav-link" href="/publications/">Publications</a>
              </li>

              <!-- Toogle theme mode -->
              <div class="toggle-container">
                <a id="light-toggle">
                  <i class="fas fa-moon"></i>
                  <i class="fas fa-sun"></i>
                </a>
              </div>
            </ul>
          </div>
        </div>
      </nav>
    </header>

    <!-- Content -->
    <div class="container mt-5">
      <!-- _layouts/post.html -->

<div class="post">

  <header class="post-header">
    <h1 class="post-title">Docker with NVIDIA Container Toolkit for Deep Learning</h1>
    <p class="post-meta">January 16, 2022</p>
    <p class="post-tags">
      <a href="/blog/2022"> <i class="fas fa-calendar fa-sm"></i> 2022 </a>
        ·  
        <a href="/blog/tag/aws">
          <i class="fas fa-hashtag fa-sm"></i> aws</a>  
          <a href="/blog/tag/deep-learning">
          <i class="fas fa-hashtag fa-sm"></i> deep-learning</a>  
          <a href="/blog/tag/docker">
          <i class="fas fa-hashtag fa-sm"></i> docker</a>  
          
        ·  
        <a href="/blog/category/software">
          <i class="fas fa-tag fa-sm"></i> software</a>  
          

    </p>
  </header>

  <article class="post-content">
    <h2 id="table-of-contents">Table of contents</h2>
<ol>
  <li><a href="#notice">Notice</a></li>
  <li><a href="#envs">Summarized environments about the docker with the Nvidia Container Toolkit</a></li>
  <li><a href="#features_dockerfile">Summarized main features of the provided Dockerfile</a></li>
  <li><a href="#installation_docker">How to install the docker</a></li>
  <li><a href="#installation_nct">How to install the Nvidia Container Toolkit</a></li>
  <li><a href="#docker_preparations">Preparations to build a Dockerfile</a></li>
  <li><a href="#docker_build">How to build a Dockerfile</a></li>
  <li><a href="#docker_container">How to run a docker container</a></li>
  <li><a href="#docker_copy">How to copy files and folders between the host and the docker container</a></li>
  <li><a href="#save_load">How to save and load a docker image</a></li>
  <li><a href="#docker_command">Basic docker command</a></li>
  <li><a href="#ref">Reference</a></li>
</ol>

<hr>

<h2 id="1-notice-">1. Notice <a name="notice"></a>
</h2>
<ul>
  <li>A guide for Docker with the Nvidia Container Toolkit (i.e. Nvidia-Docker 2.0)</li>
  <li>This is an updated post of the <a href="https://github.com/vujadeyoon/Docker-Nvidia-Container-Toolkit" target="_blank" rel="noopener noreferrer">Docker with the Nvidia Container Toolkit [1]</a>
to cover how to build a Dockerfile for deep learning.
Thus, if you are not familar with the docker commands, I highly recommend you should read the
<a href="https://github.com/vujadeyoon/Docker-Nvidia-Container-Toolkit" target="_blank" rel="noopener noreferrer">Docker with the Nvidia Container Toolkit [1]</a>
</li>
  <li>I recommend that you should ignore the commented instructions with an octothorpe, #.</li>
  <li>I recommend that you should fill in the appropriate letters between the parentheses, &lt;&gt;.</li>
</ul>

<hr>

<h2 id="2-summarized-environments-about-the-docker-with-the-nvidia-container-toolkit--">2. Summarized environments about the docker with the Nvidia Container Toolkit  <a name="envs"></a>
</h2>
<ul>
  <li>Operating System (OS): Ubuntu MATE 20.04.2 LTS (Focal)</li>
  <li>Graphics Processing Unit (GPU): NVIDIA TITAN Xp, 1ea</li>
  <li>GPU driver: Nvidia-460.91.03</li>
  <li>CUDA toolkit: CUDA-11.1</li>
  <li>cuDNN: cuDNN v8.2.1</li>
  <li>Docker: Docker version 20.10.7, build 20.10.7-0ubuntu5~20.04.2</li>
  <li>Docker image: nvidia/cuda:10.2-cudnn7-devel-ubuntu18.04</li>
</ul>

<hr>

<h2 id="3-summarized-main-features-of-the-provided-dockerfile--">3. Summarized main features of the provided Dockerfile  <a name="features_dockerfile"></a>
</h2>
<p>You can check the whole Dockerfile in the <a href="#dockerfile">7-2. Dockerfile</a>.</p>
<ul>
  <li>TensorRT: 7.0.0.11</li>
  <li>Torch2TRT: 0.1.0</li>
  <li>FFmpeg: N-105288-g45e45a6060</li>
  <li>nv-codec-headers: 10.0.26.2</li>
</ul>

<hr>

<h2 id="4-how-to-install-the-docker-">4. How to install the docker <a name="installation_docker"></a>
</h2>
<ol>
  <li>Docker installation
    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>1 <span class="nv">$ </span>curl https://get.docker.com | sh
2 <span class="nv">$ </span><span class="nb">sudo </span>systemctl start docker <span class="o">&amp;&amp;</span> <span class="nb">sudo </span>systemctl <span class="nb">enable </span>docker
</code></pre></div>    </div>
  </li>
  <li>Check the docker version.
    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>1 <span class="nv">$ </span><span class="nb">sudo </span>docker <span class="nt">--version</span>
</code></pre></div>    </div>
    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> Docker version 20.10.7, build 20.10.7-0ubuntu5~20.04.2
</code></pre></div>    </div>
  </li>
</ol>
<hr>

<h2 id="5-how-to-install-the-nvidia-container-toolkit-">5. How to install the Nvidia Container Toolkit <a name="installation_nct"></a>
</h2>
<ol>
  <li>Set up the repository and the Gnu Privacy Guard (GPG) key.
    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>1 <span class="nv">$ distribution</span><span class="o">=</span><span class="si">$(</span><span class="nb">.</span> /etc/os-release<span class="p">;</span><span class="nb">echo</span> <span class="nv">$ID$VERSION_ID</span><span class="si">)</span>
2 <span class="nv">$ </span>curl <span class="nt">-s</span> <span class="nt">-L</span> https://nvidia.github.io/nvidia-docker/gpgkey | <span class="nb">sudo </span>apt-key add -
3 <span class="nv">$ </span>curl <span class="nt">-s</span> <span class="nt">-L</span> https://nvidia.github.io/nvidia-docker/<span class="nv">$distribution</span>/nvidia-docker.list | <span class="nb">sudo tee</span> /etc/apt/sources.list.d/nvidia-docker.list
4 <span class="nv">$ </span><span class="nb">sudo </span>apt-get update
</code></pre></div>    </div>
  </li>
  <li>Install the Nvidia-Docker 2.0 for the Nvidia Container Toolkit.
    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>1 <span class="nv">$ </span><span class="nb">sudo </span>apt-get <span class="nb">install</span> <span class="nt">-y</span> nvidia-docker2
2 <span class="nv">$ </span><span class="nb">sudo </span>systemctl restart docker
</code></pre></div>    </div>
  </li>
  <li>Test the Nviida-Docker 2.0.
    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>1 <span class="nv">$ </span><span class="nb">sudo </span>docker run <span class="nt">--rm</span> <span class="nt">--gpus</span> all nvidia/cuda:10.2-base nvidia-smi
</code></pre></div>    </div>
    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> Tue Dec 22 08:40:19 2020
 +-----------------------------------------------------------------------------+
 | NVIDIA-SMI 440.100      Driver Version: 440.100      CUDA Version: 10.2     |
 |-------------------------------+----------------------+----------------------+
 | GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |
 | Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |
 |<span class="o">===============================</span>+<span class="o">======================</span>+<span class="o">======================</span>|
 |   0  TITAN Xp            Off  | 00000000:01:00.0  On |                  N/A |
 | 23%   30C    P8    10W / 250W |    518MiB / 12192MiB |      0%      Default |
 +-------------------------------+----------------------+----------------------+
    
 +-----------------------------------------------------------------------------+
 | Processes:                                                       GPU Memory |
 |  GPU       PID   Type   Process name                             Usage      |
 |<span class="o">=============================================================================</span>|
 +-----------------------------------------------------------------------------+
</code></pre></div>    </div>
  </li>
</ol>

<hr>

<h2 id="6-preparations-to-build-a-dockerfile-">6. Preparations to build a Dockerfile <a name="docker_preparations"></a>
</h2>
<ol>
  <li>Directory structure
    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nb">.</span>
├── Bash
│   └── bash_docker_utility.sh
├── Dockerfile
├── docker_utility
│   ├── awscliv2.zip
│   ├── eksctl
│   ├── ffmpeg.tar.gz
│   ├── goofys
│   ├── kubectl
│   ├── nv-codec-headers-10.0.26.2.tar.gz
│   ├── TensorRT-7.0.0.11.Ubuntu-18.04.x86_64-gnu.cuda-10.2.cudnn7.6.tar.gz
│   └── torch2trt.tar.gz
├── LICENSE
└── README.md
</code></pre></div>    </div>
  </li>
  <li>
    <p>The version of the required utilities for the docker</p>

    <ul>
      <li>If you want to refer to the official site for each utility, please click the hyperlink in the below table.</li>
    </ul>

    <table>
      <thead>
        <tr>
          <th style="text-align: center">No.</th>
          <th style="text-align: center">Utility</th>
          <th style="text-align: center">Version</th>
          <th style="text-align: center">SHA-1</th>
          <th style="text-align: center">Git commit</th>
          <th> </th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td style="text-align: center">1</td>
          <td style="text-align: center"><a href="https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html" target="_blank" rel="noopener noreferrer">awscliv2.zip</a></td>
          <td style="text-align: center">2</td>
          <td style="text-align: center">80153150f54149ca2ce5da1248130487fd791e92</td>
          <td style="text-align: center">-</td>
          <td> </td>
        </tr>
        <tr>
          <td style="text-align: center">2</td>
          <td style="text-align: center"><a href="https://github.com/weaveworks/eksctl" target="_blank" rel="noopener noreferrer">eksctl</a></td>
          <td style="text-align: center">0.79.0</td>
          <td style="text-align: center">b8c03f8706d4be4c7cc8a94aa316582809326964</td>
          <td style="text-align: center">-</td>
          <td> </td>
        </tr>
        <tr>
          <td style="text-align: center">3</td>
          <td style="text-align: center"><a href="https://git.ffmpeg.org/ffmpeg.git" target="_blank" rel="noopener noreferrer">ffmpeg.tar.gz</a></td>
          <td style="text-align: center">N-105288-g45e45a6060</td>
          <td style="text-align: center">dd3c209e500afac258db3a2fa1077d06b9650663</td>
          <td style="text-align: center">45e45a60</td>
          <td> </td>
        </tr>
        <tr>
          <td style="text-align: center">4</td>
          <td style="text-align: center"><a href="https://github.com/kahing/goofys" target="_blank" rel="noopener noreferrer">goofys</a></td>
          <td style="text-align: center">0.24.0</td>
          <td style="text-align: center">438a43f737772bf117753c3b40f524ca39814c12</td>
          <td style="text-align: center">-</td>
          <td> </td>
        </tr>
        <tr>
          <td style="text-align: center">5</td>
          <td style="text-align: center"><a href="https://docs.aws.amazon.com/eks/latest/userguide/install-kubectl.html" target="_blank" rel="noopener noreferrer">kubectl</a></td>
          <td style="text-align: center">1.17.11</td>
          <td style="text-align: center">0790bcc0d98c8f19320359b4537359ea058cfadb</td>
          <td style="text-align: center">-</td>
          <td> </td>
        </tr>
        <tr>
          <td style="text-align: center">6</td>
          <td style="text-align: center"><a href="https://github.com/FFmpeg/nv-codec-headers" target="_blank" rel="noopener noreferrer">nv-codec-headers-10.0.26.2.tar.gz</a></td>
          <td style="text-align: center">10.0.26.2</td>
          <td style="text-align: center">1006a328ba4387ae46e4b1e4b208bd064223370d</td>
          <td style="text-align: center">-</td>
          <td> </td>
        </tr>
        <tr>
          <td style="text-align: center">7</td>
          <td style="text-align: center"><a href="https://developer.nvidia.com/tensorrt" target="_blank" rel="noopener noreferrer">TensorRT-7.0.0.11.Ubuntu-18.04.x86_64-gnu.cuda-10.2.cudnn7.6.tar.gz</a></td>
          <td style="text-align: center">7.0.0.11</td>
          <td style="text-align: center">1f17eb8c0b2f1ea0c7bf935cd209a6d6f0d23f93</td>
          <td style="text-align: center">-</td>
          <td> </td>
        </tr>
        <tr>
          <td style="text-align: center">8</td>
          <td style="text-align: center"><a href="https://github.com/NVIDIA-AI-IOT/torch2trt" target="_blank" rel="noopener noreferrer">torch2trt.tar.gz</a></td>
          <td style="text-align: center">0.1.0</td>
          <td style="text-align: center">f9fa0032a7b3e5a1b434fdab4a4d5a859f01d553</td>
          <td style="text-align: center">75637700</td>
          <td> </td>
        </tr>
      </tbody>
    </table>

    <p><br></p>
    <ul>
      <li>How to get the SHA-1 in the Ubuntu
        <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>1 <span class="nv">$ </span><span class="nb">sha1sum </span>NAME_FILE 
</code></pre></div>        </div>
        <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>    CHARACTER_SHA1_40 NAME_FILE
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>Preparations for the utilities <br>
There are two options to prepare the utilities: i) <a href="#bash_docker_utility">6-4. bash_docker_utility.sh</a>; ii) <a href="https://docs.google.com/forms/d/e/1FAIpQLSc2mI35D6ArGfCReffYCUNj9TH4uRYcjsH60S4AOTEQpEWu4A/viewform?usp=sf_link" target="_blank" rel="noopener noreferrer">Google Request</a>.
I recommend that you should select the option, <a href="#bash_docker_utility">6-4. bash_docker_utility.sh</a> because of downloading the latest version of the utilities.
However, If you have any difficulties, please fill out the <a href="https://docs.google.com/forms/d/e/1FAIpQLSc2mI35D6ArGfCReffYCUNj9TH4uRYcjsH60S4AOTEQpEWu4A/viewform?usp=sf_link" target="_blank" rel="noopener noreferrer">Google Request form</a>.
After reviewing the completed request, I will give you via email that you provided a compressed file, docker_utility.zip <em><span style="color:#b409b2">(SHA-1: 4f77bf2bd59e8af8c7b31bc4d5137b6f6ac6484a)</span></em>
including all utilities. Thus, you should fill in the correct email address. 
After receiving the email, you may be able to get the compressed file using the <a href="https://github.com/wkentaro/gdown" target="_blank" rel="noopener noreferrer">gdown</a>
that is a python3 package for downloading a item from the Google Drive. <br>
Unlike the compressed file, docker_utility.zip, the <a href="#bash_docker_utility">6-4. bash_docker_utility.sh</a> does not have codes to download the <a href="https://developer.nvidia.com/tensorrt" target="_blank" rel="noopener noreferrer">TensorRT</a>.
Thus, you should download the <a href="https://developer.nvidia.com/tensorrt" target="_blank" rel="noopener noreferrer">TensorRT from the official site</a> when using the <a href="#bash_docker_utility">6-4. bash_docker_utility.sh</a>.
    <ul>
      <li>Using the <a href="#bash_docker_utility">6-4. bash_docker_utility.sh</a>
        <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> 1 <span class="nv">$ </span>bash ./Bash/bash_docker_utility.sh
</code></pre></div>        </div>
      </li>
      <li>Using the Google Drive after reviewing the <a href="https://docs.google.com/forms/d/e/1FAIpQLSc2mI35D6ArGfCReffYCUNj9TH4uRYcjsH60S4AOTEQpEWu4A/viewform?usp=sf_link" target="_blank" rel="noopener noreferrer">Google Request</a>
        <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> 1 <span class="nv">$ </span>gdown &lt;URL_TO_BE_RPOVIDED_AFTER_REVIEWING_THE_GOOLGE_REQUEST&gt;
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
</ol>

<details>
 <summary>  4. bash_docker_utility.sh <a name="bash_docker_utility"></a></summary>
 
<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><table class="rouge-table"><tbody><tr>
<td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
</pre></td>
<td class="code"><pre> <span class="c">#!/bin/bash</span>
 <span class="c">#</span>
 <span class="c">#</span>
 <span class="c"># Dveloper: vujadeyoon</span>
 <span class="c"># Email: vujadeyoon@gmail.com</span>
 <span class="c"># Github: https://github.com/vujadeyoon</span>
 <span class="c"># Personal website: https://vujadeyoon.github.io</span>
 <span class="c">#</span>
 <span class="c"># Title: bash_docker_utility.sh</span>
 <span class="c"># Description: Preparation for the required utilities.</span>
 <span class="c">#</span>
 <span class="c">#</span>
 <span class="nv">path_curr</span><span class="o">=</span><span class="si">$(</span><span class="nb">pwd</span><span class="si">)</span>
 <span class="nv">path_parent</span><span class="o">=</span><span class="si">$(</span><span class="nb">dirname</span> <span class="k">${</span><span class="nv">path_curr</span><span class="k">}</span><span class="si">)</span>
 <span class="c">#</span>
 <span class="c">#</span>
 <span class="nv">path_docker_utility</span><span class="o">=</span><span class="k">${</span><span class="nv">path_curr</span><span class="k">}</span>/docker_utility
 <span class="c">#</span>
 <span class="c">#</span>
 <span class="c"># Make a directory, docker_utility.</span>
 <span class="nb">mkdir</span> <span class="nt">-p</span> <span class="k">${</span><span class="nv">path_docker_utility</span><span class="k">}</span>
 <span class="c">#</span>
 <span class="c">#</span>
 <span class="c"># AWSCLI version 2</span>
 curl <span class="nt">--silent</span> https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip <span class="nt">-o</span> <span class="k">${</span><span class="nv">path_docker_utility</span><span class="k">}</span>/awscliv2.zip
 <span class="c">#</span>
 <span class="c">#</span>
 <span class="c"># eksctl</span>
 curl <span class="nt">--silent</span> <span class="nt">--location</span> <span class="s2">"https://github.com/weaveworks/eksctl/releases/latest/download/eksctl_</span><span class="si">$(</span><span class="nb">uname</span> <span class="nt">-s</span><span class="si">)</span><span class="s2">_amd64.tar.gz"</span> | <span class="nb">tar </span>xz <span class="nt">-C</span> <span class="k">${</span><span class="nv">path_docker_utility</span><span class="k">}</span>/
 <span class="c">#</span>
 <span class="c">#</span>
 <span class="c"># FFmpeg</span>
 git clone https://git.ffmpeg.org/ffmpeg.git <span class="k">${</span><span class="nv">path_docker_utility</span><span class="k">}</span>/ffmpeg
 <span class="nb">cd</span> <span class="k">${</span><span class="nv">path_docker_utility</span><span class="k">}</span>/ffmpeg <span class="o">&amp;&amp;</span> git checkout 45e45a606077ccd0aab7eaffb8697e633b876fb2
 <span class="nb">cd</span> <span class="k">${</span><span class="nv">path_docker_utility</span><span class="k">}</span> <span class="o">&amp;&amp;</span> <span class="nb">tar</span> <span class="nt">-czvf</span> ffmpeg.tar.gz ffmpeg
 <span class="nb">rm</span> <span class="nt">-rf</span> <span class="k">${</span><span class="nv">path_docker_utility</span><span class="k">}</span>/ffmpeg
 <span class="c">#</span>
 <span class="c">#</span>
 <span class="c"># goofys</span>
 wget <span class="nt">--quiet</span> https://github.com/kahing/goofys/releases/download/v0.24.0/goofys <span class="nt">-P</span> <span class="k">${</span><span class="nv">path_docker_utility</span><span class="k">}</span>
 <span class="c">#</span>
 <span class="c">#</span>
 <span class="c"># kubectl</span>
 curl <span class="nt">--silent</span> <span class="nt">--location</span> <span class="nt">-o</span> <span class="k">${</span><span class="nv">path_docker_utility</span><span class="k">}</span>/kubectl https://amazon-eks.s3.us-west-2.amazonaws.com/1.17.11/2020-09-18/bin/linux/amd64/kubectl
 <span class="nb">chmod</span> +x <span class="k">${</span><span class="nv">path_docker_utility</span><span class="k">}</span>/kubectl
 <span class="c">#</span>
 <span class="c">#</span>
 <span class="c"># nv-codec-headers</span>
 wget <span class="nt">--quiet</span> https://github.com/FFmpeg/nv-codec-headers/releases/download/n10.0.26.2/nv-codec-headers-10.0.26.2.tar.gz <span class="nt">-P</span> <span class="k">${</span><span class="nv">path_docker_utility</span><span class="k">}</span>
 <span class="c">#</span>
 <span class="c">#</span>
 <span class="c"># TensorRT</span>
 <span class="c"># You should download the TensorRT from the official site, https://developer.nvidia.com/tensorrt.</span>
 <span class="c">#</span>
 <span class="c">#</span>
 <span class="c"># Torch2TRT</span>
 git clone https://github.com/NVIDIA-AI-IOT/torch2trt <span class="k">${</span><span class="nv">path_docker_utility</span><span class="k">}</span>/torch2trt
 <span class="nb">cd</span> <span class="k">${</span><span class="nv">path_docker_utility</span><span class="k">}</span>/torch2trt <span class="o">&amp;&amp;</span> git checkout 756377002708121d43a3e66ba72f56af65696402
 <span class="nb">cd</span> <span class="k">${</span><span class="nv">path_docker_utility</span><span class="k">}</span> <span class="o">&amp;&amp;</span> <span class="nb">tar</span> <span class="nt">-czvf</span> torch2trt.tar.gz torch2trt
 <span class="nb">rm</span> <span class="nt">-rf</span> <span class="k">${</span><span class="nv">path_docker_utility</span><span class="k">}</span>/torch2trt
 <span class="c">#</span>
 <span class="c">#</span>
 <span class="nb">cd</span> <span class="k">${</span><span class="nv">path_curr</span><span class="k">}</span> <span class="o">||</span> <span class="k">return</span>
 
</pre></td>
</tr></tbody></table></code></pre></figure>

</details>

<hr>

<h2 id="7-how-to-build-a-dockerfile-">7. How to build a Dockerfile <a name="docker_build"></a>
</h2>
<ol>
  <li>Build a Dockerfile shown in the <a href="#dockerfile">7-2. Dockerfile</a>.
    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>1 <span class="nv">$ </span><span class="nb">sudo </span>docker build <span class="nt">-t</span> &lt;REPOSITORY&gt;:&lt;TAG&gt; <span class="nb">.</span>
</code></pre></div>    </div>
  </li>
</ol>
<details>
 <summary>  2. Dockerfile <a name="dockerfile"></a></summary>
 
<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><table class="rouge-table"><tbody><tr>
<td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
</pre></td>
<td class="code"><pre> <span class="c"># Dveloper: vujadeyoon</span>
 <span class="c"># Email: vujadeyoon@gmail.com</span>
 <span class="c"># Github: https://github.com/vujadeyoon</span>
 <span class="c"># Personal website: https://vujadeyoon.github.io</span>
 <span class="c">#</span>
 <span class="c"># Title: Dockerfile</span>
 <span class="c"># Description: A Dockerfile for the NVIDIA Container Toolkit for Deep Learning</span>
 <span class="c">#</span>
 <span class="c">#</span>
 FROM nvidia/cuda:10.2-cudnn7-devel-ubuntu18.04
 
 
 LABEL <span class="nv">maintainer</span><span class="o">=</span><span class="s2">"vujadeyoon"</span>
 LABEL <span class="nv">email</span><span class="o">=</span><span class="s2">"vujadeyoon@gmial.com"</span>
 LABEL <span class="nv">version</span><span class="o">=</span><span class="s2">"1.0"</span>
 LABEL <span class="nv">description</span><span class="o">=</span><span class="s2">"Docker with NVIDIA Container Toolkit for Deep Learning"</span>
 
 
 ENV <span class="nv">DEBIAN_FRONTEND</span><span class="o">=</span>noninteractive
 
 
 <span class="c"># 1. Install the essential ubuntu packages.</span>
 RUN apt-get update <span class="o">&amp;&amp;</span>  <span class="se">\</span>
     apt-get upgrade <span class="nt">-y</span> <span class="o">&amp;&amp;</span>  <span class="se">\</span>
     apt-get <span class="nb">install</span> <span class="nt">-y</span> <span class="nt">--no-install-recommends</span> <span class="se">\</span>
         build-essential <span class="se">\</span>
         apt-utils <span class="se">\</span>
         cmake <span class="se">\</span>
         git <span class="se">\</span>
         curl <span class="se">\</span>
         vim <span class="se">\</span>
         ssh <span class="se">\</span>
         <span class="nb">sudo</span> <span class="se">\</span>
         <span class="nb">tar</span> <span class="se">\</span>
         libcurl3-dev <span class="se">\</span>
         libfreetype6-dev <span class="se">\</span>
         pkg-config <span class="se">\</span>
         ca-certificates <span class="se">\</span>
         libjpeg-dev <span class="se">\</span>
         libpng-dev <span class="o">&amp;&amp;</span> <span class="se">\</span>
     apt-get clean <span class="o">&amp;&amp;</span> <span class="se">\</span>
     <span class="nb">rm</span> <span class="nt">-rf</span> /var/lib/apt/lists/<span class="k">*</span>
 
 
 <span class="c"># 2. Install the useful ubuntu packages.</span>
 RUN apt-get update <span class="o">&amp;&amp;</span>  <span class="se">\</span>
     apt-get <span class="nb">install</span> <span class="nt">-y</span> <span class="se">\</span>
         ffmpeg <span class="se">\</span>
         libgtk2.0-dev <span class="se">\</span>
         python3-matplotlib <span class="se">\</span>
         wget <span class="se">\</span>
         tmux <span class="se">\</span>
         zsh <span class="se">\</span>
         locales <span class="se">\</span>
         ncdu <span class="se">\</span>
         htop <span class="se">\</span>
         zip <span class="se">\</span>
         unzip <span class="se">\</span>
         rsync <span class="o">&amp;&amp;</span> <span class="se">\</span>
     apt-get clean <span class="o">&amp;&amp;</span> <span class="se">\</span>
     <span class="nb">rm</span> <span class="nt">-rf</span> /var/lib/apt/lists/<span class="k">*</span>
 
 
 <span class="c"># 3. Set the locale</span>
 RUN locale-gen en_US.UTF-8
 ENV LANG en_US.UTF-8
 ENV LANGUAGE en_US:en
 ENV LC_ALL en_US.UTF-8
 
 
 <span class="c"># 4. Install python.</span>
 RUN apt-get update <span class="o">&amp;&amp;</span> <span class="se">\</span>
     apt-get <span class="nb">install </span>software-properties-common <span class="nt">-y</span> <span class="o">&amp;&amp;</span> <span class="se">\</span>
     add-apt-repository ppa:deadsnakes/ppa <span class="nt">-y</span> <span class="o">&amp;&amp;</span> <span class="se">\</span>
     apt-get <span class="nb">install</span> <span class="nt">-y</span> <span class="se">\</span>
          python-pip <span class="se">\</span>
          python3-pip <span class="o">&amp;&amp;</span> <span class="se">\</span>
     apt-get clean <span class="o">&amp;&amp;</span> <span class="se">\</span>
     <span class="nb">rm</span> <span class="nt">-rf</span> /var/lib/apt/lists/<span class="k">*</span>
 
 
 <span class="c">## 5. Set python3.7 as default</span>
 <span class="c">#RUN apt-get update &amp;&amp; \</span>
 <span class="c">#    apt-get install -y \</span>
 <span class="c">#        python3.7 \</span>
 <span class="c">#        python3.7-dev &amp;&amp; \</span>
 <span class="c">#    apt-get clean &amp;&amp; \</span>
 <span class="c">#    rm -rf /var/lib/apt/lists/* &amp;&amp; \</span>
 <span class="c">#    rm /usr/bin/python3 &amp;&amp; \</span>
 <span class="c">#    ln -s /usr/bin/python3.7 /usr/bin/python3</span>
 
 
 <span class="c"># 6. Install more python packages</span>
 RUN pip <span class="nb">install</span> <span class="nt">--upgrade</span> pip <span class="o">&amp;&amp;</span> <span class="se">\</span>
     pip3 <span class="nb">install</span> <span class="nt">--upgrade</span> pip
 
 
 <span class="c"># 7. Python3 packages for mathematical functions and plotting</span>
 RUN pip3 <span class="nb">install</span> <span class="se">\</span>
     opencv-python<span class="o">==</span>4.5.1.48 <span class="se">\</span>
     opencv-contrib-python<span class="o">==</span>4.5.1.48 <span class="se">\</span>
     ffmpeg-python <span class="se">\</span>
     <span class="nv">Pillow</span><span class="o">==</span>7.2.0 <span class="se">\</span>
     imageio <span class="se">\</span>
     <span class="nv">kornia</span><span class="o">==</span>0.2.2 <span class="se">\</span>
     <span class="nv">matplotlib</span><span class="o">==</span>3.3.1 <span class="se">\</span>
     scikit-image <span class="se">\</span>
     scikit-learn <span class="se">\</span>
     pandas <span class="se">\</span>
     openpyxl <span class="se">\</span>
     plotly <span class="se">\</span>
     seaborn <span class="se">\</span>
     shapely
 
 
 <span class="c"># 8. Python3 packages for monitoring and debugging</span>
 RUN pip3 <span class="nb">install</span> <span class="se">\</span>
     jupyter <span class="se">\</span>
     wandb <span class="se">\</span>
     gpustat <span class="se">\</span>
     getgpu <span class="se">\</span>
     tqdm <span class="se">\</span>
     ipdb <span class="se">\</span>
     icecream
 
 
 <span class="c"># 9. Other python3 packages</span>
 RUN pip3 <span class="nb">install</span> <span class="se">\</span>
     scipy <span class="se">\</span>
     Cython <span class="se">\</span>
     prettyprinter <span class="se">\</span>
     colorlog <span class="se">\</span>
     randomcolor <span class="se">\</span>
     <span class="nv">future</span><span class="o">==</span>0.18.2 <span class="se">\</span>
     imutils <span class="se">\</span>
     psutil <span class="se">\</span>
     PyYAML <span class="se">\</span>
     pycrypto
 
 
 <span class="c"># 10. Install python3 packages for the deep learning research.</span>
 RUN pip3 <span class="nb">install</span> <span class="se">\</span>
     PyWavelets <span class="se">\</span>
     <span class="nv">pycuda</span><span class="o">==</span>2020.1 <span class="se">\</span>
     <span class="nv">torch</span><span class="o">==</span>1.4.0 <span class="se">\</span>
     <span class="nv">torchvision</span><span class="o">==</span>0.5.0 <span class="se">\</span>
     <span class="nv">torchsummary</span><span class="o">==</span>1.5.1
 
 
 <span class="c"># 11. Install python3 packages related to the server.</span>
 RUN pip3 <span class="nb">install</span> <span class="se">\</span>
     <span class="nv">flask</span><span class="o">==</span>1.1.2 <span class="se">\</span>
     Flask-RESTful<span class="o">==</span>0.3.8 <span class="se">\</span>
     <span class="nv">gevent</span><span class="o">==</span>21.1.2 <span class="se">\</span>
     <span class="nv">boto3</span><span class="o">==</span>1.17.9 <span class="se">\</span>
     <span class="nv">kubernetes</span><span class="o">==</span>12.0.1
 
 
 <span class="c"># 12. Make required directories.</span>
 RUN <span class="nb">mkdir</span> <span class="nt">-p</span> /home/Vujadeyoon/
 RUN <span class="nb">mkdir</span> <span class="nt">-p</span> /home/Vujadeyoon/vdisk/
 
 
 <span class="c"># 13. Install a python3 package, TensorRT 7.0.0.11.</span>
 <span class="c">#     i) Preparations.</span>
 RUN <span class="nb">mkdir</span> <span class="nt">-p</span> /home/Vujadeyoon/pip3_packages/
 COPY ./docker_utility/TensorRT-7.0.0.11.Ubuntu-18.04.x86_64-gnu.cuda-10.2.cudnn7.6.tar.gz /home/Vujadeyoon/pip3_packages/
 WORKDIR /home/Vujadeyoon/pip3_packages/
 <span class="c">#     ii) Uncompress the downloaded tar.gz file.</span>
 RUN <span class="nb">tar</span> <span class="nt">-xzvf</span> TensorRT-7.0.0.11.Ubuntu-18.04.x86_64-gnu.cuda-10.2.cudnn7.6.tar.gz
 RUN <span class="nb">mkdir</span> <span class="nt">-p</span> ./TensorRT-7.0.0.11/_arxiv/
 RUN <span class="nb">mv</span> ./TensorRT-7.0.0.11.Ubuntu-18.04.x86_64-gnu.cuda-10.2.cudnn7.6.tar.gz TensorRT-7.0.0.11/_arxiv/
 <span class="c">#     iii) Register an environmental variable.</span>
 ENV LD_LIBRARY_PATH <span class="nv">$LD_LIBRARY_PATH</span>:/home/Vujadeyoon/pip3_packages/TensorRT-7.0.0.11/lib
 <span class="c">#     iv) Copy plugins of the TensorRT to the CUDA toolkit directory.</span>
 RUN <span class="nb">mkdir</span> <span class="nt">-p</span> /usr/local/cuda-originals/cuda-10.2/
 RUN <span class="nb">cp</span> <span class="nt">-r</span> /usr/local/cuda-10.2/targets/ /usr/local/cuda-originals/cuda-10.2/
 RUN <span class="nb">cp</span> <span class="nt">-r</span> /home/Vujadeyoon/pip3_packages/TensorRT-7.0.0.11/include/<span class="k">*</span> /usr/local/cuda-10.2/targets/x86_64-linux/include/
 RUN <span class="nb">cp</span> <span class="nt">-r</span> /home/Vujadeyoon/pip3_packages/TensorRT-7.0.0.11/targets/x86_64-linux-gnu/lib/<span class="k">*</span> /usr/local/cuda-10.2/targets/x86_64-linux/lib/
 <span class="c">#     v) Install python3 packages related to the TensorRT.</span>
 WORKDIR /home/Vujadeyoon/pip3_packages/TensorRT-7.0.0.11/
 RUN pip3 <span class="nb">install</span> <span class="se">\</span>
     ./python/tensorrt-7.0.0.11-cp36-none-linux_x86_64.whl <span class="se">\</span>
     ./uff/uff-0.6.5-py2.py3-none-any.whl <span class="se">\</span>
     ./graphsurgeon/graphsurgeon-0.4.1-py2.py3-none-any.whl
 <span class="c">#     vi) Go to the base directory.</span>
 WORKDIR /home/Vujadeyoon/
 
 
 <span class="c"># 14. Install a python3 package, Torch2TRT.</span>
 <span class="c">#     i) Preparations.</span>
 RUN <span class="nb">mkdir</span> <span class="nt">-p</span> /home/Vujadeyoon/pip3_packages/
 COPY ./docker_utility/torch2trt.tar.gz /home/Vujadeyoon/pip3_packages/
 WORKDIR /home/Vujadeyoon/pip3_packages/
 <span class="c">#     ii) Uncompress the downloaded tar.gz file.</span>
 RUN <span class="nb">tar</span> <span class="nt">-xzvf</span> /home/Vujadeyoon/pip3_packages/torch2trt.tar.gz
 RUN <span class="nb">mkdir</span> <span class="nt">-p</span> ./torch2trt/_arxiv/
 RUN <span class="nb">mv</span> ./torch2trt.tar.gz torch2trt/_arxiv/
 <span class="c">#     iii) Install the python3 package, Torch2TRT.</span>
 WORKDIR /home/Vujadeyoon/pip3_packages/torch2trt/
 RUN python3 setup.py <span class="nb">install</span> <span class="nt">--plugins</span>
 <span class="c">#     iv) Go to the base directory.</span>
 WORKDIR /home/Vujadeyoon/
 
 
 <span class="c"># 15. Install the AWS CLI version 2 on Linux.</span>
 RUN <span class="nb">mkdir</span> <span class="nt">-p</span> /home/Vujadeyoon/AWS/
 COPY ./docker_utility/awscliv2.zip /home/Vujadeyoon/AWS/
 RUN unzip /home/Vujadeyoon/AWS/awscliv2.zip <span class="nt">-d</span> /home/Vujadeyoon/AWS/
 RUN /home/Vujadeyoon/AWS/aws/install
 RUN <span class="nb">rm</span> <span class="nt">-rf</span> /home/Vujadeyoon/AWS/
 
 
 <span class="c"># 16. Enroll the AWS credentials and config for development.</span>
 <span class="c"># RUN mkdir /root/.aws</span>
 <span class="c"># RUN echo '[default]' &gt;&gt; /root/.aws/credentials</span>
 <span class="c"># RUN echo 'aws_access_key_id = &lt;SECRET&gt;' &gt;&gt; /root/.aws/credentials</span>
 <span class="c"># RUN echo 'aws_secret_access_key = &lt;SECRET&gt;' &gt;&gt; /root/.aws/credentials</span>
 <span class="c"># RUN echo '[default]' &gt;&gt; /root/.aws/config</span>
 <span class="c"># RUN echo 'region = ap-northeast-2' &gt;&gt; /root/.aws/config</span>
 <span class="c"># RUN echo 'output = json' &gt;&gt; /root/.aws/config</span>
 
 
 <span class="c"># 17. Install the Goofys</span>
 COPY ./docker_utility/goofys /usr/local/bin/
 RUN <span class="nb">chmod</span> +x /usr/local/bin/goofys
 
 
 <span class="c"># 18. Install the EKSCTL.</span>
 COPY ./docker_utility/eksctl /usr/local/bin/
 RUN <span class="nb">chmod</span> +x /usr/local/bin/eksctl
 RUN eksctl completion bash <span class="o">&gt;&gt;</span> /root/.bash_completion
 
 
 <span class="c"># 19. Install the KUBECTL.</span>
 COPY ./docker_utility/kubectl /usr/local/bin/
 RUN <span class="nb">chmod</span> +x /usr/local/bin/kubectl
 RUN kubectl completion bash <span class="o">&gt;&gt;</span> /root/.bash_completion
 
 
 <span class="c"># 20. FFmpeg-GPU</span>
 RUN apt-get update <span class="o">&amp;&amp;</span>  <span class="se">\</span>
     apt-get <span class="nb">install</span> <span class="nt">-y</span> <span class="se">\</span>
         yasm <span class="se">\</span>
         libtool <span class="se">\</span>
         libc6 <span class="se">\</span>
         libc6-dev <span class="se">\</span>
         libnuma1 <span class="se">\</span>
         libnuma-dev <span class="se">\</span>
         libmp3lame-dev <span class="se">\</span>
         psmisc <span class="se">\</span>
         libass-dev <span class="se">\</span>
         libgl1-mesa-glx <span class="o">&amp;&amp;</span> <span class="se">\</span>
     apt-get clean <span class="o">&amp;&amp;</span> <span class="se">\</span>
     <span class="nb">rm</span> <span class="nt">-rf</span> /var/lib/apt/lists/<span class="k">*</span>
 RUN <span class="nb">mkdir</span> <span class="nt">-p</span> /home/Vujadeyoon/FFmpeg_GPU/
 COPY ./docker_utility/nv-codec-headers-10.0.26.2.tar.gz /home/Vujadeyoon/FFmpeg_GPU/
 COPY ./docker_utility/ffmpeg.tar.gz /home/Vujadeyoon/FFmpeg_GPU/
 WORKDIR /home/Vujadeyoon/FFmpeg_GPU/
 RUN <span class="nb">tar</span> <span class="nt">-xzvf</span> nv-codec-headers-10.0.26.2.tar.gz
 RUN <span class="nb">tar</span> <span class="nt">-xzvf</span> ffmpeg.tar.gz
 WORKDIR /home/Vujadeyoon/FFmpeg_GPU/nv-codec-headers-10.0.26.2/
 RUN make <span class="nb">install</span>
 <span class="c"># RUN git clone https://git.videolan.org/git/ffmpeg/nv-codec-headers.git</span>
 <span class="c"># RUN cd nv-codec-headers &amp;&amp; make install &amp;&amp; cd /data</span>
 WORKDIR /home/Vujadeyoon/FFmpeg_GPU/ffmpeg/
 RUN ./configure <span class="nt">--enable-cuda-sdk</span> <span class="nt">--enable-cuvid</span> <span class="nt">--enable-nvenc</span> <span class="nt">--enable-nonfree</span> <span class="nt">--enable-libnpp</span>  <span class="nt">--enable-libass</span> <span class="nt">--enable-libmp3lame</span> <span class="nt">--extra-cflags</span><span class="o">=</span><span class="nt">-I</span>/usr/local/cuda/include <span class="nt">--extra-ldflags</span><span class="o">=</span><span class="nt">-L</span>/usr/local/cuda/lib64 <span class="o">&amp;&amp;</span> make <span class="nt">-j</span> 8 <span class="o">&amp;&amp;</span> make <span class="nb">install</span>
 
 
 <span class="c"># 21. Update and clean the Ubuntu packages.</span>
 RUN apt-get update <span class="o">&amp;&amp;</span>  <span class="se">\</span>
     apt-get clean <span class="o">&amp;&amp;</span> <span class="se">\</span>
     <span class="nb">rm</span> <span class="nt">-rf</span> /var/lib/apt/lists/<span class="k">*</span>
 
 
 <span class="c"># 22. Go to the base directory.</span>
 WORKDIR /home/Vujadeyoon/
 
 
 <span class="c"># 23. Run the command.</span>
 CMD <span class="o">[</span> <span class="s2">"/bin/bash"</span> <span class="o">]</span>
 
</pre></td>
</tr></tbody></table></code></pre></figure>

</details>

<hr>

<h2 id="8-how-to-run-a-docker-container-">8. How to run a docker container <a name="docker_container"></a>
</h2>
<ol>
  <li>Run a docker container corresponding to the docker image, &lt;REPOSITORY&gt;:&lt;TAG&gt; with some useful options.
    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>1 <span class="nv">$ </span><span class="nb">sudo </span>docker run <span class="nt">-it</span> <span class="nt">--rm</span> <span class="nt">--privileged</span> <span class="nt">--runtime</span> nvidia <span class="nt">-p</span> &lt;PORT_HOST&gt;:&lt;PORT_CONTAINER&gt; <span class="nt">-v</span> &lt;PATH_HOST&gt;:&lt;PATH_CONTAINER&gt; &lt;REPOSITORY&gt;:&lt;TAG&gt; <span class="s2">"/bin/bash"</span>
</code></pre></div>    </div>
  </li>
</ol>
<hr>

<h2 id="9-how-to-copy-files-and-folders-between-the-host-and-a-docker-container-">9. How to copy files and folders between the host and a docker container <a name="docker_copy"></a>
</h2>
<p>You can get the &lt;CONTAINER_ID&gt; using the below command. If you are not familar with the command, please refer to the <a href="#docker_command">11. Basic docker command</a>.
The items can be both folders or files.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1 <span class="nv">$ </span><span class="nb">sudo </span>docker ps <span class="nt">--all</span>
</code></pre></div></div>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  CONTAINER ID   IMAGE          COMMAND                  CREATED        STATUS                      PORTS     NAMES
</code></pre></div></div>

<ol>
  <li>Copy itmes from the host to the docker container.
    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>1 <span class="nv">$ </span>docker <span class="nb">cp</span> &lt;PATH_HOST&gt; &lt;CONTAINER_ID&gt;:&lt;PATH_CONTAINER&gt;
</code></pre></div>    </div>
  </li>
  <li>Copy itmes from the docker container to the host.
    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>1 <span class="nv">$ </span>docker <span class="nb">cp</span> &lt;CONTAINER_ID&gt;:&lt;PATH_CONTAINER&gt; &lt;PATH_HOST&gt;
</code></pre></div>    </div>
  </li>
</ol>

<hr>

<h2 id="10-how-to-save-and-load-a-docker-image-">10. How to save and load a docker image <a name="save_load"></a>
</h2>
<ol>
  <li>Save a docker image.
    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>1 <span class="nv">$ </span><span class="nb">sudo </span>docker save &lt;REPOSITORY:TAG&gt; <span class="nt">-o</span> &lt;NAME_TAR&gt;.tar
</code></pre></div>    </div>
  </li>
  <li>Load a pre-built docker image.
    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>1 <span class="nv">$ </span><span class="nb">sudo </span>docker load <span class="nt">-i</span> &lt;NAME_TAR&gt;.tar
</code></pre></div>    </div>
  </li>
</ol>

<hr>

<h2 id="11-basic-docker-command-">11. Basic docker command <a name="docker_command"></a>
</h2>
<ol>
  <li>Exit the docker container.
    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>1 <span class="nv">$ </span>ctrl + d
</code></pre></div>    </div>
  </li>
  <li>List docker images.
    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>1 <span class="nv">$ </span><span class="nb">sudo </span>docker images
</code></pre></div>    </div>
  </li>
  <li>List all docker containers.
    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>1 <span class="nv">$ </span><span class="nb">sudo </span>docker ps <span class="nt">--all</span>
</code></pre></div>    </div>
  </li>
  <li>Stop a docker container.
    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>1 <span class="nv">$ </span><span class="nb">sudo </span>docker stop &lt;CONTAINER_ID&gt;
</code></pre></div>    </div>
  </li>
  <li>Start the stopped docker container.
    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>1 <span class="nv">$ </span><span class="nb">sudo </span>docker start &lt;CONTAINER_ID&gt;
</code></pre></div>    </div>
  </li>
  <li>Attach a working docker container.
    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>1 <span class="nv">$ </span><span class="nb">sudo </span>docker attach &lt;CONTAINER_ID&gt;
</code></pre></div>    </div>
  </li>
  <li>Remove docker containers.
    <ol>
      <li>Remove docker containers corresponding to the container ID list.
        <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> 1 <span class="nv">$ </span><span class="nb">sudo </span>docker <span class="nb">rm</span> &lt;CONTAINER_ID_1&gt;, &lt;CONTAINER_ID_2&gt; ,..., &lt;CONTAINER_ID_N&gt; 
</code></pre></div>        </div>
      </li>
      <li>Remove all docker containers.
        <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> 1 <span class="nv">$ </span><span class="nb">sudo </span>docker <span class="nb">rm</span> <span class="sb">`</span><span class="nb">sudo </span>docker ps <span class="nt">-a</span> <span class="nt">-q</span><span class="sb">`</span>
</code></pre></div>        </div>
      </li>
    </ol>
  </li>
  <li>Remove a docker images.
    <ol>
      <li>Remove docker images corresponding to the docker image list.
        <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> 1 <span class="nv">$ </span><span class="nb">sudo </span>docker rmi &lt;IMAGE_1&gt;, &lt;IMAGE_2&gt; ,..., &lt;IMAGE_N&gt;
</code></pre></div>        </div>
      </li>
      <li>Remove docker images with the corresponding docker containers from the given docker image list.
        <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> 1 <span class="nv">$ </span><span class="nb">sudo </span>docker rmi <span class="nt">-f</span> &lt;IMAGE_1&gt;, &lt;IMAGE_2&gt; ,..., &lt;IMAGE_N&gt;
</code></pre></div>        </div>
      </li>
    </ol>
  </li>
</ol>

<hr>

<h2 id="12-reference-">12. Reference <a name="ref"></a>
</h2>
<ol>
  <li><a href="https://github.com/vujadeyoon/Docker-Nvidia-Container-Toolkit" title="Docker-Nvidia-Container-Toolkit" target="_blank" rel="noopener noreferrer"> Docker-Nvidia-Container-Toolkit</a></li>
  <li><a href="https://www.docker.com" title="Docker" target="_blank" rel="noopener noreferrer"> Docker</a></li>
  <li><a href="https://github.com/NVIDIA/nvidia-docker" title="Nvidia-Docker" target="_blank" rel="noopener noreferrer"> Github for the Nvidia-Docker</a></li>
  <li><a href="https://docs.nvidia.com/datacenter/cloud-native" title="Nvidia-Docker" target="_blank" rel="noopener noreferrer"> Document for the Nvidia-Docker</a></li>
</ol>

<hr>


  </article><div id="disqus_thread"></div>
    <script type="text/javascript">
      var disqus_shortname  = 'vujadeyoon';
      var disqus_identifier = '/blog/2022/docker_with_NVIDIA_container_toolkit_for_deep_learning';
      var disqus_title      = "Docker with NVIDIA Container Toolkit for Deep Learning";
      (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript" target="_blank" rel="noopener noreferrer">comments powered by Disqus.</a>
</noscript>

</div>

    </div>

    <!-- Footer -->    
    <footer class="fixed-bottom">
      <div class="container mt-0">
        © Copyright 2023 <a href="https://vujadeyoon.github.io" target="_blank">Sungjun Yoon</a>. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="noopener noreferrer">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" target="_blank" rel="noopener noreferrer">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="noopener noreferrer">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="noopener noreferrer">Unsplash</a>.

      </div>
    </footer>

    <!-- JavaScripts -->
    <!-- jQuery -->
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

    <!-- Bootsrap & MDB scripts -->
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.2/dist/umd/popper.min.js" integrity="sha256-l/1pMF/+J4TThfgARS6KwWrk/egwuVvhRzfLAMQ6Ds4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js" integrity="sha256-SyTu6CwrfOhaznYZPoolVw2rxoY7lKYKQvqbtqN93HI=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script>

    <!-- Mansory & imagesLoaded -->
  <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script>
  <script defer src="/assets/js/mansory.js" type="text/javascript"></script>
    
  <!-- Medium Zoom JS -->
  <script src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script>
  <script src="/assets/js/zoom.js"></script><!-- Load Common JS -->
  <script src="/assets/js/common.js"></script>

    <!-- MathJax -->
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        tags: 'ams'
      }
    };
  </script>
  <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script>
  <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>

    
  </body>
</html>

